<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Spinner с прогресс-баром</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100..900&display=swap" rel="stylesheet">

<style>
body {
  background: #DDD;
  margin: 0;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  font-family: 'Roboto', sans-serif; 
  color: #000;
}

.dialog {
  background: #fff;
  border-radius: 32px 32px 0 0;
  padding: 64px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.15);
  display: flex;
  flex-direction: column;
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  box-sizing: border-box;
  gap: 20px;
}

h2 {
  font-size: 58px;
  font-weight: 600;
  margin-bottom: 80px;
}

.spinners {
  display: flex;
  gap: 40px;
  margin: 40px 0;
}

.spinners span {
  align-content: center;
  font-size: 34px;  
}

.spinner {
  width: 100%;
  height: 500px; 
  overflow: hidden;
  position: relative;
  touch-action: none;
}

.items {
  position: relative;
}

.item {
  height: 100px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 38px;
  opacity: 0.4;
  transition: transform 0.15s, opacity 0.15s;
}

.item.active {
  opacity: 1;
}

.center-marker {
  position: absolute;
  top: 50%;
  left: 0;
  width: 100%;
  height: 90px;
  margin-top: -45px;
  border-top: 1px solid #AAA;
  border-bottom: 1px solid #AAA;
  pointer-events: none;
}

.values {
  width: 100%;
  display: flex;
  justify-content: space-between;
  font-size: 38px;
  padding: 0 0;
  box-sizing: border-box;
  display: none;
}


.center-text {
  display: block;
  text-align: center;
  font-size: 32px;
  margin-top: 10px;
}

.progress-container {
  position: relative;
  width: 100%;
  height: 24px;
  border-radius: 6px;
  background: #eee;
  margin: 10px 0;
}

.progress-left {
  position: absolute;
  height: 100%;
  border-radius: 6px;
  background: #9CE4BD;
  width: 0;
  right: 50%;
}

.progress-right {
  position: absolute;
  height: 100%;
  border-radius: 6px;
  background: #FF8D8D;
  width: 0;
  left: 50%;
}

.progress-center {
  position: absolute;
  top: 0;
  left: 50%;
  width: 2px;
  height: 200%;
  background: #000;
  transform: translateX(-50%);
  z-index: 1;
}

.exclude-row {
  width: 100%;
  max-width: 880px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 20px 0;
  font-size: 38px;
  color: #333;
  padding: 0 10px;
  box-sizing: border-box;
}

.custom-checkbox {
  position: relative;
  display: inline-block;
  width: 40px;
  height: 40px;
}

.custom-checkbox input {
  opacity: 0;
  width: 0;
  height: 0;
}

.custom-checkbox .checkmark {
  position: absolute;
  top: 0;
  left: 0;
  height: 40px;
  width: 40px;
  background-color: #eee;
  border-radius: 6px;
  border: 1px solid #ccc;
  cursor: pointer;
}

.custom-checkbox input:checked + .checkmark {
  background-color: #DB001B;
  border-color: #DB001B;
}

.custom-checkbox .checkmark:after {
  content: "";
  position: absolute;
  display: none;
}

.custom-checkbox input:checked + .checkmark:after {
  display: block;
}

.custom-checkbox .checkmark:after {
  left: 12px;
  top: 6px;
  width: 9px;
  height: 16px;
  border: solid white;
  border-width: 0 6px 6px 0;
  transform: rotate(45deg);
}

.bottom-buttons {
  width: 100%;
  display: flex;
  justify-content: flex-end;
  gap: 20px;
  margin: 40px 0;
  padding: 0 10px;
  box-sizing: border-box;
}

.btn {
  font-size: 38px;
  font-family: 'Roboto';
  font-weight: 500;
  padding: 20px 16px;
  border: none;
  border-radius: 8px;
  background: #fff;
  color: #DB001B;
  cursor: pointer;
  text-transform: uppercase;
  transition: 0.15s ease;
}
</style>
</head>
<body>

<div class="dialog">
  <h2>Отклонение цены</h2>

  <div class="values">
    <span id="val1" class="val-left"></span>
    <span id="val2" class="val-right"></span>
  </div>

  <div class="progress-container">
    <div class="progress-left"></div>
    <div class="progress-center"></div>
    <div class="progress-right"></div>
  </div>

  <span class="center-text">Оценка Дрома</span>

  <div class="spinners">
    <span>от</span>
    <div class="spinner" id="spinner1">
      <div class="items" id="items1"></div>
      <div class="center-marker"></div>
    </div>
    <span>до</span>
    <div class="spinner" id="spinner2">
      <div class="items" id="items2"></div>
      <div class="center-marker"></div>
    </div>
  </div>

  <label class="exclude-row">
    <span>Исключить объявления без оценки</span>
    <div class="custom-checkbox">
      <input type="checkbox" checked>
      <span class="checkmark"></span>
    </div>
  </label>

  <div class="bottom-buttons">
    <button class="btn cancel" onclick="resetSpinners()">Сбросить</button>
    <button class="btn apply">Применить</button>
  </div>
</div>

<script>
const itemHeight = 100;
let selected1 = -Infinity;
let selected2 = Infinity;

// форматирование выводимых значений
function formatNumber(n) {
  if (n === Infinity) return "–";      // для +∞
  if (n === -Infinity) return "–";     // для -∞
  return (n > 0 ? "+" : "") + n.toLocaleString('ru-RU'); // плюсы остаются
}

function createSpinner(containerId, values, startValue = 0, onChange) {
  const spinner = document.getElementById(containerId);
  const itemsBox = spinner.querySelector('.items');

  // создаём элементы спиннера
  values.forEach(v => {
    const div = document.createElement("div");
    div.className = "item";
    div.textContent = formatNumber(v);
    itemsBox.appendChild(div);
  });

  let index = values.indexOf(startValue);
  if (index === -1) index = 0;

  let y = -index * itemHeight + 2 * itemHeight;
  let dragging = false;
  let start = 0;

  const maxY = 2 * itemHeight;
  const minY = -(values.length - 3) * itemHeight;

  function update() {
    y = Math.min(maxY, Math.max(minY, y));
    itemsBox.style.transform = `translateY(${y}px)`;

    let activeIndex = Math.round((-y + 2 * itemHeight) / itemHeight);
    activeIndex = Math.min(values.length - 1, Math.max(0, activeIndex));

    itemsBox.querySelectorAll(".item").forEach((el, i) => {
      el.classList.toggle("active", i === activeIndex);
      const distance = Math.abs(i - activeIndex);
      el.style.opacity = distance === 0 ? 1 : (distance === 1 ? 0.4 : 0.2);
    });

    if (onChange) onChange(values[activeIndex]);
  }

  function snap() {
    let activeIndex = Math.round((-y + 2 * itemHeight) / itemHeight);
    activeIndex = Math.min(values.length - 1, Math.max(0, activeIndex));
    const targetY = -activeIndex * itemHeight + 2 * itemHeight;
    const startY = y;
    const diff = targetY - startY;
    const duration = 180;
    let startTime = null;

    function animate(t) {
      if (!startTime) startTime = t;
      let progress = (t - startTime) / duration;
      if (progress > 1) progress = 1;
      y = startY + diff * (1 - Math.pow(1 - progress, 3));
      update();
      if (progress < 1) requestAnimationFrame(animate);
    }

    requestAnimationFrame(animate);
  }

  spinner.addEventListener("pointerdown", e => {
    dragging = true;
    spinner.setPointerCapture(e.pointerId);
    start = e.clientY - y;
  });

  spinner.addEventListener("pointermove", e => {
    if (!dragging) return;
    y = e.clientY - start;
    update();
  });

  spinner.addEventListener("pointerup", () => {
    dragging = false;
    snap();
  });

  update();

  return {
    getValue: () => {
      let activeIndex = Math.round((-y + 2 * itemHeight) / itemHeight);
      activeIndex = Math.min(values.length - 1, Math.max(0, activeIndex));
      return values[activeIndex];
    }
  };
}

// массивы значений
const values1 = [
  -1000000, -900000, -800000, -700000, -600000,
  -500000, -400000, -300000, -200000, -100000, -50000,
   -Infinity,
   50000, 100000, 200000, 300000, 400000, 500000,
   600000, 700000, 800000, 900000, 1000000
];

const values2 = [
  -1000000, -900000, -800000, -700000, -600000, -500000,
  -400000, -300000, -200000, -100000, -50000, 
  Infinity,
   50000, 100000, 200000, 300000, 400000, 500000,
   600000, 700000, 800000, 900000, 1000000
];

// создаём спиннеры
createSpinner('spinner1', values1, -Infinity, val => {
  selected1 = val;
  updateImage();
});
createSpinner('spinner2', values2, Infinity, val => {
  selected2 = val;
  updateImage();
});

// обновление значений над графиком
function updateImage() {
  document.getElementById("val1").textContent = formatNumber(selected1);
  document.getElementById("val2").textContent = formatNumber(selected2);
  updateProgress(selected1, selected2);
}

// обновление прогресс-бара
function updateProgress(leftValue, rightValue) {



  const leftBar = document.querySelector('.progress-left');
  const rightBar = document.querySelector('.progress-right');
  const maxAbs = 1000000;
  const minWidthPercent = 0.4;

    if (
    (leftValue === -Infinity && rightValue === -Infinity) ||
    (leftValue === Infinity && rightValue === Infinity) ||
    (leftValue === -Infinity && rightValue === Infinity) ||
    (leftValue === Infinity && rightValue === -Infinity)
  ) {
    leftBar.style.left = '0%';
    leftBar.style.width = '50%';
    rightBar.style.left = '50%';
    rightBar.style.width = '50%';
    return; 
  }

  const left = leftValue === -Infinity ? -maxAbs : (leftValue === Infinity ? maxAbs : leftValue);
  const right = rightValue === -Infinity ? -maxAbs : (rightValue === Infinity ? maxAbs : rightValue);

  const start = Math.min(left, right);
  const end = Math.max(left, right);

  // левая полоса (отрицательные)
  if (start < 0) {
    const leftStart = Math.min(start, 0);
    const leftEnd = Math.min(end, 0);
    const widthPercent = Math.abs(leftEnd - leftStart)/maxAbs*50;
    leftBar.style.left = (50 + leftStart/maxAbs*50) + '%';
    leftBar.style.width = Math.max(widthPercent, minWidthPercent) + '%';
  } else {
    leftBar.style.width = '0';
  }

  // правая полоса (положительные)
  if (end > 0) {
    const rightStart = Math.max(start, 0);
    const rightEnd = Math.max(end, 0);
    const widthPercent = (rightEnd - rightStart)/maxAbs*50;
    rightBar.style.left = (50 + rightStart/maxAbs*50) + '%';
    rightBar.style.width = Math.max(widthPercent, minWidthPercent) + '%';
  } else {
    rightBar.style.width = '0';
  }
}

updateImage();


function resetSpinners() {
  // очищаем содержимое
  document.getElementById("items1").innerHTML = "";
  document.getElementById("items2").innerHTML = "";

  selected1 = -Infinity;
  selected2 = Infinity;

  updateImage();

  // просто снова создаём спиннеры с начальными значениями
  createSpinner('spinner1', values1, -Infinity, val => {
    selected1 = val;
    updateImage();
  });

  createSpinner('spinner2', values2, Infinity, val => {
    selected2 = val;
    updateImage();
  });
}

</script>


</body>
</html>
